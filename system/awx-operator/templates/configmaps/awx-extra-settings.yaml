{{- if .Values.AWX.enabled }}
---
# ConfigMap for static settings (no secrets)
apiVersion: v1
kind: ConfigMap
metadata:
  name: awx-settings-configmap
  annotations:
    argocd.argoproj.io/sync-wave: "-4"
data:
  settings.py: |
    # AWX Extra Settings - Generic OIDC Configuration for Keycloak
    import os

    # Generic OIDC settings for Keycloak (shows "Sign in with OIDC" button)
    SOCIAL_AUTH_OIDC_KEY = "{{ .Values.oidc.clientId }}"
    SOCIAL_AUTH_OIDC_SECRET = os.environ.get("SOCIAL_AUTH_KEYCLOAK_SECRET", "")
    SOCIAL_AUTH_OIDC_OIDC_ENDPOINT = "https://keycloak.ops.techsecom.io/realms/master"

    # Security Settings
    SESSION_COOKIE_SECURE = True
    CSRF_COOKIE_SECURE = True

    # Enable HTTPS redirect for social auth
    SOCIAL_AUTH_REDIRECT_IS_HTTPS = True
{{- end }}
