clickhouse:
  # Use bitnamilegacy for available images
  image:
    registry: docker.io
    repository: bitnamilegacy/clickhouse
    pullPolicy: IfNotPresent

  # Cluster name
  clusterName: gitlab

  # Authentication
  auth:
    username: gitlab
    existingSecret: clickhouse-auth
    existingSecretKey: password

  # Single shard, single replica for simplicity
  shards: 1
  replicaCount: 1

  # Keeper disabled - using standalone mode for simplicity
  keeper:
    enabled: false

  # Zookeeper disabled
  zookeeper:
    enabled: false

  # Resources
  resources:
    requests:
      cpu: 500m
      memory: 2Gi
    limits:
      cpu: 4
      memory: 16Gi

  # Persistence
  persistence:
    enabled: true
    storageClass: longhorn
    size: 100Gi

  # Service
  service:
    type: ClusterIP

  # Startup/liveness/readiness probes with generous timeouts
  startupProbe:
    enabled: true
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 30
    successThreshold: 1

  livenessProbe:
    enabled: true
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 6
    successThreshold: 1

  readinessProbe:
    enabled: true
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 6
    successThreshold: 1

  # Volume permissions disabled - Longhorn handles this
  defaultInitContainers:
    volumePermissions:
      enabled: false

  # Extra configuration for gitlab user grants
  extraOverrides: |
    <clickhouse>
      <users>
        <gitlab>
          <access_management>0</access_management>
        </gitlab>
      </users>
    </clickhouse>
