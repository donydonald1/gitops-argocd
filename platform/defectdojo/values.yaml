defectdojo:
  fullnameOverride: defectdojo
  host: defectdojo.ops.techsecom.io
  siteUrl: https://defectdojo.ops.techsecom.io

  # Avoid ArgoCD hook issues
  disableHooks: true

  # Security context
  securityContext:
    enabled: true

  # Django/Nginx configuration
  django:
    ingress:
      enabled: true
      activateTLS: false
      annotations:
        # Homepage dashboard integration
        gethomepage.dev/enabled: "true"
        gethomepage.dev/name: "DefectDojo"
        gethomepage.dev/description: "Security Vulnerability Management"
        gethomepage.dev/group: "Platform"
        gethomepage.dev/icon: "defectdojo.png"
        gethomepage.dev/href: "https://defectdojo.ops.techsecom.io"
        cert-manager.io/cluster-issuer: letsencrypt-prod
    uwsgi:
      livenessProbe:
        initialDelaySeconds: 30
    mediaPersistentVolume:
      persistentVolumeClaim:
        size: 2Gi

  # External PostgreSQL - CNPG Cluster
  postgresql:
    enabled: false
  postgresServer: "cnpg-cluster-pooler-rw.cnpg-system.svc.cluster.local"
  postgresPort: "5432"

  # Valkey (Redis-compatible) for Celery broker
  valkey:
    enabled: true
    auth:
      existingSecret: defectdojo-valkey-specific
      existingSecretPasswordKey: valkey-password

  # Keycloak OIDC Configuration
  extraConfigs:
    # Security cookies
    DD_SESSION_COOKIE_SECURE: 'True'
    DD_CSRF_COOKIE_SECURE: 'True'
    DD_SECURE_SSL_REDIRECT: 'False'
    # Keycloak OIDC settings
    DD_SOCIAL_AUTH_KEYCLOAK_OAUTH2_ENABLED: 'True'
    DD_SOCIAL_AUTH_KEYCLOAK_KEY: 'defectdojo'
    DD_SOCIAL_AUTH_KEYCLOAK_AUTHORIZATION_URL: 'https://keycloak.ops.techsecom.io/realms/master/protocol/openid-connect/auth'
    DD_SOCIAL_AUTH_KEYCLOAK_ACCESS_TOKEN_URL: 'https://keycloak.ops.techsecom.io/realms/master/protocol/openid-connect/token'

  # Create secrets from ExternalSecrets
  createSecret: false
  createValkeySecret: false
  createPostgresqlSecret: false

# Keycloak OIDC Client Configuration
oidc:
  enabled: true
  clientId: defectdojo
  redirectUris:
    - "https://defectdojo.ops.techsecom.io/*"
  webOrigins:
    - "https://defectdojo.ops.techsecom.io"

# External Secrets Operator Configuration
eso:
  enabled: true

# Vault secret keys required (path: secret/defectdojo):
# - adminPassword: DefectDojo admin password
# - secretKey: Django secret key
# - credentialAesKey: AES 256 encryption key
# - metricsPassword: Metrics HTTP auth password
# - oidcClientSecret: Keycloak OIDC client secret
# - dbUsername: Database username (defectdojo)
# - dbPassword: Database password
# - valkeyPassword: Valkey (Redis) password
