redis:
  fullnameOverride: redis-cache
  image:
    registry: docker.io
    repository: bitnamilegacy/redis
  auth:
    enabled: true
    existingSecret: redis-creds
    existingSecretPasswordKey: REDIS_PASSWORD
    sentinel: false
  # Performance tuning for GitLab cache Redis (caching layer)
  commonConfiguration: |-
    maxmemory 8gb
    maxmemory-policy allkeys-lru
    timeout 0
    tcp-keepalive 300
    activerehashing yes
    lazyfree-lazy-eviction yes
    lazyfree-lazy-expire yes
    lazyfree-lazy-server-del yes
    io-threads 4
    io-threads-do-reads yes
    # Cache-specific optimizations
    save ""
  architecture: replication
  replica:
    replicaCount: 3
    disableCommands:
      - FLUSHDB
    # Increased resources for better cache performance
    resources:
      requests:
        cpu: 500m
        memory: 2Gi
      limits:
        cpu: 2
        memory: 10Gi
    persistence:
      enabled: true
      storageClass: nfs-csi
      size: 60Gi
    terminationGracePeriodSeconds: 60
    startupProbe:
      enabled: true
      initialDelaySeconds: 60
      periodSeconds: 20
      timeoutSeconds: 20
      successThreshold: 1
      failureThreshold: 30
    readinessProbe:
      enabled: true
      initialDelaySeconds: 60
      periodSeconds: 20
      timeoutSeconds: 20
      successThreshold: 1
      failureThreshold: 10
    livenessProbe:
      enabled: true
      initialDelaySeconds: 90
      periodSeconds: 15
      timeoutSeconds: 15
      successThreshold: 1
      failureThreshold: 10
  sentinel:
    enabled: true
    masterSet: mymaster
    quorum: 2
    replicas: 3
    terminationGracePeriodSeconds: 60
    persistence:
      enabled: true
      storageClass: nfs-csi
      size: 60Gi
    startupProbe:
      enabled: true
      initialDelaySeconds: 60
      periodSeconds: 15
      timeoutSeconds: 15
      failureThreshold: 20
    readinessProbe:
      enabled: true
      initialDelaySeconds: 60
      periodSeconds: 10
      timeoutSeconds: 10
      failureThreshold: 10
    livenessProbe:
      enabled: true
      initialDelaySeconds: 90
      periodSeconds: 15
      timeoutSeconds: 10
      failureThreshold: 10
  volumePermissions:
    enabled: true
    image:
      registry: docker.io
      repository: bitnamilegacy/os-shell
  metrics:
    enabled: true
    # Increase CPU limits to prevent throttling during Prometheus scrapes
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 256Mi
    serviceMonitor:
      enabled: true
      additionalLabels:
        release: prometheus
    startupProbe:
      enabled: true
      initialDelaySeconds: 60
      periodSeconds: 20
      timeoutSeconds: 20
      successThreshold: 1
      failureThreshold: 10
    livenessProbe:
      enabled: true
      initialDelaySeconds: 90
      periodSeconds: 10
      timeoutSeconds: 10
      successThreshold: 1
      failureThreshold: 5
    readinessProbe:
      enabled: true
      initialDelaySeconds: 60
      periodSeconds: 5
      timeoutSeconds: 5
      successThreshold: 1
      failureThreshold: 3
