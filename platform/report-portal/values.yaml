reportportal:
  # Enable ArgoCD compatibility
  global:
    argocd:
      enabled: true
    pdb:
      create: true
      maxUnavailable: "1"

  # Service configurations with production resources
  serviceindex:
    resources:
      requests:
        cpu: 150m
        memory: 128Mi
      limits:
        cpu: 300m
        memory: 256Mi
    podAnnotations:
      reloader.stakater.com/auto: "true"

  serviceui:
    replicaCount: 2
    resources:
      requests:
        cpu: 100m
        memory: 64Mi
      limits:
        cpu: 200m
        memory: 128Mi
    podAnnotations:
      reloader.stakater.com/auto: "true"

  serviceapi:
    replicaCount: 2
    resources:
      requests:
        cpu: 500m
        memory: 1Gi
      limits:
        cpu: 1000m
        memory: 2Gi
    podAnnotations:
      reloader.stakater.com/auto: "true"

  uat:
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 200m
        memory: 512Mi
    podAnnotations:
      reloader.stakater.com/auto: "true"
    # Superadmin password from secret
    superadminInitPasswd:
      secretName: reportportal-superadmin-creds
      passwordKeyName: password

  serviceanalyzer:
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 500m
        memory: 512Mi
    podAnnotations:
      reloader.stakater.com/auto: "true"

  serviceanalyzertrain:
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 500m
        memory: 512Mi
    podAnnotations:
      reloader.stakater.com/auto: "true"

  # Metrics collection job
  metricsgatherer:
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 100m
        memory: 128Mi

  # Jobs service
  servicejobs:
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 500m
        memory: 512Mi
    podAnnotations:
      reloader.stakater.com/auto: "true"

  # Ingress configuration
  ingress:
    enable: true
    usedomainname: true
    class: nginx
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-prod
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
      nginx.ingress.kubernetes.io/proxy-body-size: "128m"
      nginx.ingress.kubernetes.io/proxy-buffer-size: "512k"
      nginx.ingress.kubernetes.io/proxy-buffers-number: "4"
      nginx.ingress.kubernetes.io/proxy-busy-buffers-size: "512k"
      nginx.ingress.kubernetes.io/proxy-connect-timeout: "300"
      nginx.ingress.kubernetes.io/proxy-read-timeout: "300"
      nginx.ingress.kubernetes.io/proxy-send-timeout: "300"
    hosts:
      - reportportal.ops.techsecom.io
    # TLS configuration for cert-manager
    tls:
      certificates:
        - hosts:
            - reportportal.ops.techsecom.io
          secretName: reportportal-tls

  # External PostgreSQL - CNPG Cluster
  database:
    secretName: reportportal-postgresql-creds
    endpoint: cnpg-cluster-pooler-rw.cnpg-system.svc.cluster.local
    port: 5432
    user: reportportal
    dbName: reportportal
    # Password comes from secret

  # Disable embedded PostgreSQL - using external CNPG
  postgresql:
    install: false

  # External Elasticsearch - ECK Stack
  searchengine:
    secretName: reportportal-elasticsearch-creds
    endpoint: elasticsearch-es-http.elastic-system.svc.cluster.local
    port: 9200
    ssl: true
    sslVerify: false
    # Using SSL with verification disabled for internal cluster communication
    # User/password come from secret

  # Disable embedded OpenSearch - using external Elasticsearch
  opensearch:
    install: false

  # External MinIO S3 Storage
  storage:
    type: minio
    secretName: reportportal-minio-creds
    accesskeyName: "access-key"
    secretkeyName: "secret-key"
    endpoint: minio.minio.svc.cluster.local
    port: 9000
    ssl: false
    bucket:
      type: single
      bucketDefaultName: "reportportal"

  # Disable embedded MinIO - using external MinIO
  minio:
    install: false

  # RabbitMQ - use embedded with external secret
  rabbitmq:
    install: true
    image:
      repository: bitnamilegacy/rabbitmq
      tag: 4.1.2-debian-12-r1
    auth:
      existingPasswordSecretName: reportportal-rabbitmq-creds
      existingSecretPasswordKey: password
      existingErlangSecretName: reportportal-rabbitmq-creds
      existingSecretErlangKey: erlang-cookie
    extraPlugins: >
      rabbitmq_auth_backend_ldap
      rabbitmq_consistent_hash_exchange
      rabbitmq_shovel
      rabbitmq_shovel_management
    extraConfiguration: |-
      max_message_size = 134217728
    persistence:
      enabled: true
      size: 10Gi
      storageClass: nfs-csi
    resources:
      requests:
        cpu: 200m
        memory: 512Mi
      limits:
        cpu: 500m
        memory: 1Gi
    podAnnotations:
      reloader.stakater.com/auto: "true"
