botkube:
  # Cluster settings
  settings:
    clusterName: ops-dc-tx-pl-hq-prd
    configWatcher: true
    upgradeNotifier: true
    log:
      level: debug
      disableColors: false

  # Disable analytics
  analytics:
    disable: true

  # NOTE: Slack Socket Mode tokens must be provided directly in the config.
  # The env var override mechanism (BOTKUBE_COMMUNICATIONS__*) does NOT work
  # for Slack credentials. For production, use ArgoCD Vault Plugin (AVP) to
  # inject secrets into values at sync time.
  #
  # The tokens are stored in Vault at: secret/botkube
  # Keys: slackBotToken, slackAppToken

  # Ingress configuration
  ingress:
    create: true
    host: "kubebot.ops.techsecom.io"
    className: nginx
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
    tls:
      enabled: true
      secretName: "botkube-tls"

  # Communication platforms configuration
  # For production: Use ArgoCD Vault Plugin (AVP) to inject real tokens
  # Example with AVP: botToken: <path:secret/data/botkube#slackBotToken>
  communications:
    default-group:
      socketSlack:
        enabled: true
        # IMPORTANT: Replace these with real tokens or use AVP for production
        botToken: "<path:secret/data/botkube#slackBotToken>"
        appToken: "<path:secret/data/botkube#slackAppToken>"
        channels:
          default:
            name: kubebot-alerts
            bindings:
              executors:
                - kubectl-read-only
              sources:
                # Only alert on errors/warnings - k8s-events is too noisy
                - k8s-errors

  # Service monitor for Prometheus
  serviceMonitor:
    enabled: true
    labels:
      release: kube-prometheus-stack

  # Resource limits
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # Pod security context
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    runAsGroup: 1000

  # Executors configuration
  executors:
    # Read-only kubectl access
    kubectl-read-only:
      botkube/kubectl:
        enabled: true
        config:
          defaultNamespace: default
          interactiveBuilder:
            allowed:
              namespaces:
                - ".*"
                - "default"
              verbs:
                - get
                - list
                - describe
                - logs
                - top
              resources:
                - pods
                - services
                - deployments
                - statefulsets
                - daemonsets
                - jobs
                - cronjobs
                - configmaps
                - nodes
                - namespaces
                - events
                - ingresses
                - persistentvolumeclaims
                - persistentvolumes
        # RBAC context - required for kubectl plugin to work
        context:
          rbac:
            group:
              type: Static
              static:
                values:
                  - botkube-plugins-default

    # Full kubectl access (restricted to admins)
    kubectl-full-access:
      botkube/kubectl:
        enabled: true
        config:
          defaultNamespace: default
          interactiveBuilder:
            allowed:
              namespaces:
                - ".*"
                - "default"
              verbs:
                - get
                - list
                - describe
                - logs
                - top
                - delete
                - rollout
                - scale
                - exec
              resources:
                - pods
                - services
                - deployments
                - statefulsets
                - daemonsets
                - jobs
                - cronjobs
                - configmaps
                - secrets
                - nodes
                - namespaces
                - events
                - ingresses
                - persistentvolumeclaims
        # RBAC context - required for kubectl plugin to work
        context:
          rbac:
            group:
              type: Static
              static:
                values:
                  - botkube-plugins-default

    # Helm executor (disabled - plugin not available in v1.14.0)
    # helm-readonly:
    #   botkube/helm:
    #     enabled: true
    #     config:
    #       helmDriver: secret
    #       helmCacheDir: /tmp/helm/.cache
    #       helmConfigDir: /tmp/helm/

  # Actions configuration
  actions:
    # Disabled - was using k8s-events which is too noisy
    # describe-created-resource:
    #   enabled: true
    #   displayName: "Describe created resource"
    #   command: "kubectl describe {{ .Event.Kind }}/{{ .Event.Name }} -n {{ .Event.Namespace }}"
    #   bindings:
    #     sources:
    #       - k8s-events
    #     executors:
    #       - kubectl-read-only

    show-logs-on-error:
      enabled: true
      displayName: "Show logs on error"
      command: "kubectl logs {{ .Event.Kind }}/{{ .Event.Name }} -n {{ .Event.Namespace }} --tail=100"
      bindings:
        sources:
          - k8s-errors
        executors:
          - kubectl-read-only

  # Sources configuration
  sources:
    # General Kubernetes events - DISABLED (too noisy)
    # Uncomment and adjust if you want create/update notifications
    # k8s-events:
    #   displayName: "Kubernetes Events"
    #   botkube/kubernetes:
    #     enabled: true
    #     config:
    #       namespaces:
    #         include:
    #           - "production"  # Only specific namespaces
    #         exclude:
    #           - kube-system
    #           - cattle-system
    #       event:
    #         types:
    #           - create  # Remove 'update' to reduce noise
    #       resources:
    #         - type: apps/v1/deployments  # Only critical resources
    #         - type: v1/nodes
    #     context:
    #       rbac:
    #         group:
    #           type: Static
    #           static:
    #             values:
    #               - botkube-plugins-default

    # Error events
    k8s-errors:
      displayName: "Kubernetes Errors"
      botkube/kubernetes:
        enabled: true
        config:
          namespaces:
            include:
              - ".*"
          event:
            types:
              - error
              - warning
          resources:
            - type: v1/pods
            - type: v1/nodes
            - type: apps/v1/deployments
            - type: apps/v1/statefulsets
            - type: apps/v1/daemonsets
            - type: batch/v1/jobs
        context:
          rbac:
            group:
              type: Static
              static:
                values:
                  - botkube-plugins-default

    # Recommendation events
    k8s-recommendations:
      displayName: "Kubernetes Recommendations"
      botkube/kubernetes:
        enabled: true
        config:
          namespaces:
            include:
              - ".*"
          recommendations:
            pod:
              noLatestImageTag: true
              labelsSet: true
            ingress:
              backendServiceValid: true
              tlsSecretValid: true
        context:
          rbac:
            group:
              type: Static
              static:
                values:
                  - botkube-plugins-default

    # Prometheus alerts source
    prometheus-alerts:
      displayName: "Prometheus Alerts"
      botkube/prometheus:
        enabled: true
        config:
          url: "http://kube-prometheus-stack-prometheus.monitoring:9090"
          alertStates:
            - firing
            - pending
          ignoreOldAlerts: true
        context:
          rbac:
            group:
              type: Static
              static:
                values:
                  - botkube-plugins-default

    # CRD monitoring
    crds:
      displayName: "Custom Resources"
      botkube/kubernetes:
        enabled: true
        config:
          namespaces:
            include:
              - ".*"
          event:
            types:
              - create
              - delete
              - error
          resources:
            - name: monitoring.coreos.com/v1/podmonitors
            - name: monitoring.coreos.com/v1/servicemonitors
            - name: cert-manager.io/v1/certificates
            - name: argoproj.io/v1alpha1/applications
        context:
          rbac:
            group:
              type: Static
              static:
                values:
                  - botkube-plugins-default

  # NOTE: extraEnv for BOTKUBE_COMMUNICATIONS__* does NOT work for Slack tokens.
  # The env var override mechanism fails to properly apply to nested communication
  # config. Use AVP (ArgoCD Vault Plugin) to inject secrets directly into values.

# External Secrets Operator configuration
eso:
  enabled: true

# Node selector (optional)
nodeSelector: {}

# Tolerations (optional)
tolerations: []

# Affinity (optional)
affinity: {}
